{% extends 'base.html' %}
{#{% load static %}#}

{% block title %}
    首页
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <!-- 搜索栏 -->
            <div class="col-6"><br>
                <form class="input-group" method="get">
                    <label style="width: 400px">
                        {% if search %}
                            <input type="text" class="form-control"
                                   name="search" value="{{ search }}" required>
                        {% else %}
                            <input type="text" class="form-control"
                                   name="search" placeholder="请输入文章或关键词..." required>
                        {% endif %}
                    </label>

                    <span class="input-group-btn">
                        <button class="btn btn-default" type="submit">搜一下</button>
                    </span>
                    <i class="fa fa-search" aria-hidden="true"></i>
                </form>
            </div>

            <!-- new or hot -->
            <div class="col-6" aria-label="breadcrumb">
                <br>
                <ol class="breadcrumb">
                    {% if order == 'common' %}
                        <li class="breadcrumb-item">
                            <a>最新发布</a>
                        </li>
                    {% else %}
                        <li class="breadcrumb-item">
                            <a href="{% url 'article:article_list' %}?order=common&search={{ search }}">最新发布</a>
                        </li>
                    {% endif %}

                    {% if order == 'total_visit' %}
                        <li class="breadcrumb-item">
                            <a>浏览最多</a>
                        </li>
                    {% else %}
                        <li class="breadcrumb-item">
                            <a href="{% url 'article:article_list' %}?order=total_visit&search={{ search }}">浏览最多</a>
                        </li>
                    {% endif %}
                </ol>
            </div>
        </div>

        <!-- 搜索提示语 -->
        {% if search %}
            {% if articles %}
                <h4><span style="color: red">"{{ search }}"</span>的搜索结果如下：</h4>
                <hr>
            {% else %}
                <h4>暂无与<span style="color: red">"{{ search }}"</span>有关的文章。</h4>
                <hr>
            {% endif %}
        {% endif %}
        <!-- 文章预览 -->
        <div class="row mt-2">
            {% for article in articles %}
                <div class="col-4 mb-4">
                    <div class="card h-100">
                        <!-- 标题 -->
                        <h4 class="card-header">
                            {{ article.title }}
                        </h4>
                        <!-- 摘要 -->
                        <div class="card-body">
                            <p class="card-text">
                                {{ article.body | slice:'100' }}...
                            </p>
                        </div>
                        <!-- 注脚 -->
                        <div class="card-footer">

                            <a href="{% url 'article:article_detail' article.pk %}" class="btn btn-primary">
                                阅读本文
                            </a>

                            <span>
                                <small class="col align-self-end" style="color: gray;">
                                    浏览: {{ article.total_visit }}
                                </small>
                            </span>

                            <span>
                                <small class="col align-self-end" style="color: gray;">
                                    评论:
                                </small>
                            </span>

                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- 分页组件 -->
        <ul class="pagination">

            {% if articles.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1&order={{ order }}&search={{ search }}">首页</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">首页</span></li>
            {% endif %}


            {% if articles.has_previous %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ articles.previous_page_number }}&order={{ order }}&search={{ search }}">上一页</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">上一页</span></li>
            {% endif %}


            {% for i in page_list %}
                {% if articles.number == i %}
                    <li class="page-item disabled"><a class="page-link">{{ i }}</a></li>
                {% else %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ i }}&order={{ order }}&search={{ search }}">{{ i }}</a></li>
                {% endif %}
            {% endfor %}


            {% if articles.has_next %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ articles.next_page_number }}&order={{ order }}&search={{ search }}">下一页</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">下一页</span></li>
            {% endif %}


            {% if articles.has_next %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ articles.paginator.num_pages }}&order={{ order }}&search={{ search }}">尾页</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">尾页</span></li>
            {% endif %}
        </ul>
    </div>
{% endblock %}